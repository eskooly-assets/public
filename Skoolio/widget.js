function initializeChatbot(){const chatHTML=`<div class="chat-container"><div class="chat-icon"><img src="https://eskooly.com/bb/assets/images/skoolio.png" style="max-height:30px;"></i><div class="notification-badge"></div></div><div class="chat-box"><div class="chat-header"><h3 class="chat-title"><div style="display:inline;"><img src="https://eskooly.com/bb/assets/images/icon.png" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;"></div><div style="display:inline;margin-left:10px;position:relative;"><strong style="color:#fff;">eSkooly</strong><i class="fa-sharp fa-solid fa-badge-check" style="font-size:14px !important;color:#f0b30c;"></i><div class="typing-indicator"><span>Skoolio</span><div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div></div></h3><button class="close-btn"><i class="fa-solid fa-xmark"></i></button></div><div class="chat-messages"><div class="agents" style="justify-content: center;margin-bottom:10px;display: flex;align-items: center;width:100%;"><img src="https://eskooly.com/bb/assets/images/skoolio.webp" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;"><img src="https://eskooly.com/bb/assets/images/mudassar.png" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;margin-left:-15px;"><img src="https://eskooly.com/bb/assets/images/elie.png" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;margin-left:-15px;"><img src="https://eskooly.com/bb/assets/images/lakisha.png" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;margin-left:-15px;"><img src="https://eskooly.com/bb/assets/images/mohsin.png" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;margin-left:-15px;"><img src="https://eskooly.com/bb/assets/images/emily.png" style="width:40px;height:40px;border-radius:30px;vertical-align: middle;border:2px solid #fff;margin-left:-15px;"></div><div class="message bot-message">Hi 👋 there! How can we help you today?</div></div><div class="chat-input"><input type="text" placeholder="Type your message..." id="messageInput" autocomplete="off"><button class="send-btn"><i class="fa-solid fa-arrow-up"></i></button></div></div></div>`;document.body.insertAdjacentHTML("beforeend",chatHTML);const chatContainer=document.querySelector(".chat-container");function checkForExistingSessionId(length=6){const storedId=localStorage.getItem("eskooly-chat-id");if(storedId)return storedId;const newId=Array.from({length},()=> "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(Math.random()*62)]).join("");localStorage.setItem("eskooly-chat-id",newId);return newId}function playAudio(){new Audio("https://eskooly.com/bb/assets/pop.mp3").play().catch(()=>{})}function toggleChat(){const chatBox=chatContainer.querySelector(".chat-box");const chatIcon=chatContainer.querySelector(".chat-icon");chatBox.classList.toggle("active");messagesContainer.scrollTop=messagesContainer.scrollHeight}function formatLists(message){message=message.replace(/(?:^|\n)\* (.+)/g,(match,p1)=>`<li>${p1}</li>`);if(message.includes("<li>"))message=`<ul>${message}</ul>`;return message}function formatLineBreaks(message){return message.replace(/\n/g,"<br>")}function formatInlineCode(message){return message.replace(/`(.*?)`/g,"<code>$1</code>")}function formatBlockquotes(message){return message.replace(/^> (.+)/gm,"<blockquote>$1</blockquote>")}function formatHeaders(message){message=message.replace(/^# (.+)/gm,"<h1>$1</h1>");message=message.replace(/^## (.+)/gm,"<h2>$1</h2>");message=message.replace(/^### (.+)/gm,"<h3>$1</h3>");return message}function saveChatToSession(sessionId,message,sender){const chatHistory=JSON.parse(sessionStorage.getItem(sessionId))||[];chatHistory.push({sender,message});sessionStorage.setItem(sessionId,JSON.stringify(chatHistory))}function loadChatHistory(sessionId,messagesContainer){const chatHistory=JSON.parse(sessionStorage.getItem(sessionId))||[];chatHistory.forEach(chat=>{const senderClass=chat.sender==="user"?"user-message":"bot-message";messagesContainer.insertAdjacentHTML("beforeend",`<div class="message ${senderClass}">${chat.message}</div>`)});messagesContainer.scrollTop=messagesContainer.scrollHeight}function formatMessage(message){message=formatHeaders(message);message=message.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");message=message.replace(/\*(.*?)\*/g,"<em>$1</em>");message=message.replace(/\[(.*?)\]\((https?:\/\/[^\s]+)\)/g,'<a href="$2" target="_blank">$1</a>');message=formatLists(message);message=formatLineBreaks(message);message=formatInlineCode(message);message=formatBlockquotes(message);return message}function sendMessage(){const input=chatContainer.querySelector("#messageInput");const message=input.value.trim();if(!message)return;const messagesContainer=chatContainer.querySelector(".chat-messages");const sessionId=checkForExistingSessionId();messagesContainer.insertAdjacentHTML("beforeend",`<div class="message user-message">${message}</div>`);saveChatToSession(sessionId,message,"user");input.value="";messagesContainer.scrollTop=messagesContainer.scrollHeight;chatContainer.querySelector(".typing-indicator").style.display="flex";fetch("https://eskooly.com/chatbot/chatbot.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`message=${encodeURIComponent(message)}&sessionId=${sessionId}`}).then(response=>response.json()).then(data=>{const responseWithLinks=formatMessage(data.response||"Sorry for the inconvenience.🙏 At the moment all agents are busy. Please try again later.");messagesContainer.insertAdjacentHTML("beforeend",`<div class="message bot-message">${responseWithLinks}</div>`);saveChatToSession(sessionId,responseWithLinks,"bot");playAudio()}).catch(()=>{messagesContainer.insertAdjacentHTML("beforeend",'<div class="message bot-message">Sorry for the inconvenience. Our agents are currently busy. Please try again later.</div>');saveChatToSession(sessionId,"Our agents are currently busy.","bot");playAudio()}).finally(()=>{chatContainer.querySelector(".typing-indicator").style.display="none";messagesContainer.scrollTop=messagesContainer.scrollHeight})}const sessionId=checkForExistingSessionId();const messagesContainer=chatContainer.querySelector(".chat-messages");loadChatHistory(sessionId,messagesContainer);chatContainer.querySelector(".chat-icon").addEventListener("click",toggleChat);chatContainer.querySelector(".close-btn").addEventListener("click",toggleChat);chatContainer.querySelector(".send-btn").addEventListener("click",sendMessage);chatContainer.querySelector("#messageInput").addEventListener("keypress",e=>{if(e.key==="Enter")sendMessage()});document.addEventListener("click",e=>{if(!chatContainer.contains(e.target)){chatContainer.querySelector(".chat-box").classList.remove("active");chatContainer.querySelector(".chat-icon").style.transform="rotate(0) scale(1)"}});setTimeout(()=>{chatContainer.querySelector(".notification-badge").style.display="block";playAudio()},3000)}if(document.readyState==="complete"){initializeChatbot()}else{window.addEventListener("load",initializeChatbot)}
